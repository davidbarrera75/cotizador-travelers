<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Cotizador Travelers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
    </style>
  </head>
  <body class="gradient-bg min-h-screen flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">
          Cotizador Travelers
        </h1>
        <p class="text-gray-600">Panel de Administración</p>
      </div>

      <form id="loginForm" class="space-y-6">
        <div>
          <label
            for="username"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Usuario
          </label>
          <input
            type="text"
            id="username"
            name="username"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            placeholder="Ingresa tu usuario"
          />
        </div>

        <div>
          <label
            for="password"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Contraseña
          </label>
          <input
            type="password"
            id="password"
            name="password"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
            placeholder="Ingresa tu contraseña"
          />
        </div>

        <div
          id="error-message"
          class="hidden bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg"
        ></div>

        <button
          type="submit"
          id="loginBtn"
          class="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white font-semibold py-3 px-4 rounded-lg hover:from-purple-700 hover:to-purple-800 transition duration-200"
        >
          Iniciar Sesión
        </button>
      </form>

      <div class="mt-6 text-center">
        <a
          href="/cotizador.html"
          class="text-sm text-purple-600 hover:text-purple-800"
        >
          ← Volver al Cotizador
        </a>
      </div>
    </div>

    <script>
      document
        .getElementById('loginForm')
        .addEventListener('submit', async (e) => {
          e.preventDefault();

          const loginBtn = document.getElementById('loginBtn');
          const errorDiv = document.getElementById('error-message');

          // Deshabilitar botón mientras se procesa
          loginBtn.disabled = true;
          loginBtn.textContent = 'Iniciando sesión...';
          errorDiv.classList.add('hidden');

          const username = document.getElementById('username').value;
          const password = document.getElementById('password').value;

          try {
            const response = await fetch('/api/login', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              credentials: 'include',
              body: JSON.stringify({ username, password }),
            });

            const data = await response.json();

            if (response.ok && data.success) {
              // Login exitoso, redirigir al dashboard
              window.location.href = '/dashboard.html';
            } else {
              // Mostrar error
              errorDiv.textContent = data.error || 'Error al iniciar sesión';
              errorDiv.classList.remove('hidden');
            }
          } catch (error) {
            console.error('Error:', error);
            errorDiv.textContent =
              'Error de conexión. Por favor intenta de nuevo.';
            errorDiv.classList.remove('hidden');
          } finally {
            // Rehabilitar botón
            loginBtn.disabled = false;
            loginBtn.textContent = 'Iniciar Sesión';
          }
        });

      // Verificar si ya está autenticado
      async function checkAuth() {
        try {
          const response = await fetch('/api/check-auth', {
            credentials: 'include',
          });
          const data = await response.json();

          if (data.authenticated) {
            // Ya está autenticado, redirigir al dashboard
            window.location.href = '/dashboard.html';
          }
        } catch (error) {
          console.error('Error verificando autenticación:', error);
        }
      }

      // Verificar al cargar la página
      checkAuth();
    </script>
  </body>
</html>
